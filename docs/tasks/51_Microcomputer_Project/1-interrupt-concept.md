# 第一节：51单片机中断系统

**本节知识点**

- 51单片机的中断过程
- 51单片机的中断系统结构
- 中断系统的相关寄存器
- 中断响应及初始化的一般步骤

## 一、中断相关概念
- **中断源：**引起中断的事件

- **中断请求：**中断源向CPU提出处理的请求

- **断点：**发生中断时被打断程序的暂停点

- **中断响应：**CPU暂停现行程序而转为响应中断请求的过程

- **中断处理程序：**处理中断源的程序

- **中断返回：**返回断点的过程

## 二、中断响应过程

![中断响应示意图](http://upload-images.jianshu.io/upload_images/6757403-a353a93a87dd7b46.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

> 类比于看电影 -> 电话响 -> 暂停电影去接电话 -> 接完电话回来 -> 继续看电影

![中断(异常)处理过程](http://upload-images.jianshu.io/upload_images/6757403-5f73efd7bba72df5.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

## 三、中断与普通程序调用的区别

?> 调用有点相似、但两者是不同的概念。

- **源不同:**中断是由外部中断源产生的、具有不可预测和随机性、比如抛异常；普通程序调用是由主程序安排调用的。
- **响应不同：**中断系统需要保护断点和现场；子程序只需保存断点。
- **功能不同：**中断程序主要处理CPU外部异步事件；子程序调用是为主程序服务。

## 四、中断系统结构

51单片机有5种中断源（52有6个，多了定时器2中断），2个优先级，可以实现中断嵌套

| 中断名  | 中断源  | 中断编号 |
| ---- | ---- | ---- |
|      |      |      |

 | 外部中断0                                | IE0(P3.2)                                                                     |   0    |  

| 定时器0溢出中断                     | TF0                                                                              |    1    |  
| 外部中断1                                 | IE1(P3.3)                                                                    |   2    |  
| 定时器1溢出中断                     | TF 1                                                                              |    3    |  
| 串行口中断                                | RI                                                                                 |    4    |  

**51单片机的中断号：**

- 外部中断0（INT0）,对应中断号是0, 中断入口地址0003H
- 定时/计数器0（T1）,对应中断号1 ,中断入口地址000BH
- 外部中断1（INT1）,中断号2 入口地址0013H
- 定时/计数器1（T1）中断号3 入口地址001BH
- 串行口（RI/TI）中断号4 入口地址0023H
> 这五个是AT89S51的，52还多了下面这个
- 定时/计数器2（T2）中断号5,入口地址002BH
- 函数名()interrupt 0 {} //对应外部中断0；
- 函数名()interrupt 1 {} //对应定时器/计数器0中断；
- 函数名()interrupt 2 {} //对应外部中断1；
- 函数名()interrupt 3 {} //对应定时器/计数器1中断；
- 函数名()interrupt 4 {} //对应串口中断；

一共5种中断，优先级自上向下；[摘自百度知道link](https://zhidao.baidu.com/question/119187737.html)]

## 五、控制中断的相关寄存器

**下面的寄存器主要与中断程序的书写控制有关:**

- 1.中断允许控制寄存器IE
- 2.定时器控制寄存器TCON
- 3.串口控制寄存器SCON
- 4.中断优先控制寄存器IP
- 5.定时器工作方式控制寄存器TMOD
- 6.定时器初值赋予寄存器（TH0/TH1,TL0/TL1）

## 六、部分寄存器详解
### 1.中断允许控制寄存器（IE）
![IE](http://upload-images.jianshu.io/upload_images/6757403-16ac9adf108af532.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

- EX0：外部中断0允许位； 
- ET0：定时/计数器T0中断允许位； 
- EX1：外部中断1允许位； 
- ET1：定时/计数器T1中断允许位； 
- ES ：串行口中断允许位； 
- EA ：CPU中断允许（总允许）位。 

### 2.定时器控制寄存器（TCON）
![TCON](http://upload-images.jianshu.io/upload_images/6757403-8e2a176b1fb285a6.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

- IT0：外部中断0触发方式控制位 
  - 当IT0=0时，为电平触发方式（低电平有效） 
  - 当IT0=1时，为边沿触发方式（下降沿有效） 
- IE0：外部中断0中断请求标志位 
- IT1：外部中断1触发方式控制位 
- IE1：外部中断1中断请求标志位 
- TF0：定时/计数器T0溢出中断请求标志位 
- TF1：定时/计数器T1溢出中断请求标志位 

### 3.串口控制寄存器（SCON）
![SCON](http://upload-images.jianshu.io/upload_images/6757403-f619d78b0293c430.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

- RI：串行口接收中断标志位。当允许串行口接收数据时，每接收完一个串行帧，由硬件置位RI。注意，RI必须由软件清除。 
- TI：串行口发送中断标志位。当CPU将一个发送数据写入串行口发送缓冲器时，就启动了发送过程。每发送完一个串行帧，由硬件置位TI。CPU响应中断时，不能自动清除TI，TI必须由软件清除。 

### 4.中断优先控制寄存器（IP）
![20151122152929747.jpg](http://upload-images.jianshu.io/upload_images/6757403-8d7af93bbd62ff5c.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

- PX0：外部中断0优先级设定位 
- PT0：定时/计数器T0优先级设定位 
- PX1：外部中断0优先级设定位 
- PT1：定时/计数器T1优先级设定位 
- PS ：串行口优先级设定位 
- PT2：定时/计数器T2优先级设定位

## 七、中断响应条件

- 中断源有中断请求
- 此中断源的中断允许位为1
- 开总中断（EA=1）

## 八、中断初始化的一般步骤

- 1、确定工作方式（即对TMOD赋值）；
- 2、预置定时或计数的初值（可直接将初值写入TH0、TL0或TH1、TL1）；
- 3、根据需要开放定时器/计数器的中断（直接对IE位赋值）；
- 4、启动定时器/计数器（若已规定用软件启动，则可把TR0或TR1置“1”；若已规定由外中断引脚电平启动，则需给外引脚加启动电平。当实现了启动要求后，定时器即按规定的工作方式和初值开始计数或定时）。